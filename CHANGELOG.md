# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/), and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [unreleased]

## [0.10.1]

### Changed

- Running BigChem containers from `mtzgroup` rather than `coltonbh`

## [0.10.0]

### Changed

- Changed `pipenv` for `poetry`
- Updated python `3.9` -> `3.11`
- Updated tests to only depend upon `httpx` and removed `requests` library
- Updated BigChem to `0.4.0` and installing from PyPi now

## [0.9.1]

### Changed

- Updated BigChem to `0.3.0` released on PyPi instead of building from GitHub.
- Updated a bunch of packages in `Pipfile.lock`
- Updated dependencies for `isort` and added explicit `Optional[]` typing for `mypy`

## [0.9.0] - 2022-07-19

### Changed

- Changed projects name from `QCCloud` to `ChemCloud`
- Updated `bigqc` to `bigchem`

## [0.8.1] - 2022-07-15

### Changed

- Changed distributed algorithms from being called `qcc` algorithms to `bigqc` algorithms to correctly identify where they are coming from.

## [0.8.0] - 2022-07-14

### Changed

- Updated project name from TeraChem Cloud to Quantum Chemistry Cloud

## [0.7.2] - 2022-07-11

### Changed

- Pass only strings for default values to `compute_tcc` function that executes distributed algorithms. Passing `Enum` values caused celery to try and deserialize objects containing references to the `terachem_cloud` package where the `Enums` were defined.

## [0.7.1] - 2022-07-12

### Changed

- Update to BigQCv0.1.3

## [0.7.0] - 2022-06-14

### Changed

- Refactored all backend workers and middleware to a separate out the BigQC project. This project now comprises just a web layer on top of the BigQC engine. This change resulted in the need to change a few environment variables to reflect the change to BigQC. `CELERY_BROKER_CONNECTION_STRING` -> `BIGQC_BROKER_URL` and `CELERY_BACKEND_CONNECTION_STRING` -> `BIGQC_BACKEND_URL`.
- Changed dependencies to reflect the refactor.

## [0.6.2] - 2022-06-02

### Changed

- Removed webserver memory constraints at docker level. Large results were crashing server because of 500MB limit. When (300MB+) results were pulled into memory server would require >500MB memory and would be terminated by process manager.
- Increased gunicorn worker timeout from 30s -> 60s to accommodate larger results.
- Set results to expire in 3 days instead of default 1 day in backend store.

## [0.6.1] - 2022-04-25

### Added

- Patched `geomeTRIC` to enable `transition=True` for json inputs used in `QCEngine`

## [0.6.0] - 2022-04-02

### Changed

- `/compute/result` changed to `GET` request with signature `/compute/result/{task_id}`
- Removed much unnecessary internal code around managing Task state due to saving task structure to the DB so that
  clients only have to supply a single task ID regardless if the task is a batch or single calculation.

## [0.5.1] - 2022-03-27

### Added

- Base64 encode bytes input values submitted to terachem_fe by client

## [0.5.0] - 2022-03-26

### Added

- ðŸš¨BREAKING CHANGEðŸš¨: Support for `native_files` protocol that enables end users to retrieves files generated by a QC package during computation. E.g., can retrieve `c0` files from a TeraChem computation. Only a breaking change if end user has an old version of `qcelemental` that does not support the `native_files` protocol and output field.
- Users can upload `c0` files to seed a TeraChem computation with a wave function.
- TeraChem Frontend containers to XStream deployment to access files created by TeraChem job.

### Changed

- ðŸš¨BREAKING CHANGEðŸš¨: Supported Engine for TeraChem changed from `terachem_pbs` -> `terachem_fe`
- ðŸš¨BREAKING CHANGEðŸš¨: `tcc_kwargs` -> `tcc:keywords`
- Pegged versions of psi4, rdkit, and xtb-python. Updated qcelemental to work with psi4v1.5. Updated python packages without pegged versions.
- Updated app to run python3.9.
- Updated CircleCI python3.7->3.9.
- Updated XStream TeraChem workers to new image.

## [0.4.2] - 2021-06-11

### Added

- "tcc" compute engine
- Parallel hessian and parallel frequency analysis methods to tcc engine

### Changed

- Changed celery serializer from `json` to `pickle`. This allows chained methods to receive python data types directly, rather than serialized representations. Since users do not have direct access to the celery layer and can only submit json serialized (and validated) objects via the API I do not feel there are security risks.

## [0.4.1] - 2021-06-07

### Added

- Private queues for compute

## [0.4.0] - 2021-06-04

### Added

- Batch compute capabilities to `/compute` and `/compute-procedure`

### Changed

- ðŸš¨BREAKING CHANGEðŸš¨: Updated `/compute*` endpoints to return `Task` objects including `GroupTask` objects that may contain subtasks instead of returning a single `str` of the `task_id`
- ðŸš¨BREAKING CHANGEðŸš¨: Updated `/result` endpoint to accept `Task` objects instead of just a `str` of `task_id`. This included updating the endpoint to be a `POST` instead of `GET` endpoint.

## [0.3.5] - 2021-05-26

### Added

- `xtb` to compute engines
- Added `cached-property` package since `kombu` didn't install it by default as a dependency into the linux docker container.

### Changed

- Updated `tcpb>=0.8.0`
- Updated `celery` version

## [0.3.4] - 2021-05-21

### Added

- `geomeTRIC` optimizer
- `rdkit` engine (adds force fields which can be used for single point computations or in optimizers)

### Changed

- Run compute tests on hydrogen instead of water for faster results

## [0.3.3] - 2021-05-19

### Added

- `compute_procedure` task for doing geometry optimizations using `pyberny`
- VSCode settings file added to repo.

### Changed

- Combined two commands from the CI/CD pipeline used against XStream to get fewer auth errors
- Updated `mypy` definitions on `Settings` object to pass `mypy` checks while still allowing tests to run on CircleCi without needing Auth0 configuration. I.e., the web application can be run without needing Auth0 config (for testing purposes).
- pre-commit `mypy` now loads from GitHub repo instead of local `mypy` install.

## [0.3.2] - 2021-04-06

### Added

- Test assertions to check that results are deleted from celery backend after retrieval by client.

### Changed

- Added flags `--without-heartbeat --without-mingle --without-gossip` to celery workers to reduce network overhead chattiness.
- Delete celery results from backend upon retrieval by client. This will prevent Redis from becoming a memory hog at times of high computational load.

## [0.3.1] - 2021-03-10

### Added

- Changelog
- Updated `tcpb` package to `>=0.7.1` to enable molden file creation using `imd_orbital_type="whole_c"` keyword.

## [0.3.0] - 2021-01-26

### Added

- Added TeraChem Protocol Buffer server to available compute engines.
- XStream deployment for both dev and prod now require GPUs to power Terachem. Deployment config for dev/prod was split into `docker-compose.xstream.dev.yaml` and `docker-compose.xstream.prod.yaml`.
- TeraChem license.key docker secret to swarm on XStream
- `architecture.md` to `/docs/development` to document core architectural decisions.
- Links on user dashboard to `qccloud` python client, `/logout`, and a brief description of how to change password.
- Links to `users/dashboard` on the main documentation page.
- Forgotten `__init__.py` to `terachem_cloud` package. Added `__version__` to file. This causes `mypy` checks to fail as they were previously not inspecting this package fully due to missing `__init__.py`.
- `TaskStatus` enum to hold task status values.

### Changed

- `/compute/result/{task_id}` can return either `AtomicResult` or `FailedOperation` objects.
- CircleCi build pipelines to only include a single build step for web and workers instead of a split pipeline for dev/prod
- Can approve CircleCi build and deploy steps upfront without having to wait for tests to pass. Build/deploy will still only occur if tests pass.
- XStream stacks for dev/prod no longer derive from the same template file.
- Changed `CeleryAtomicResult` to `TaskResult` and change `atomic_result` attribute to just `result` to note that `result` may now be an `AtomicResult` or a `FailedOperation` (a result could either of these data types).

## [0.2.1] - 2021-01-21

### Removed

- Removed `docker_layer_caching` from CircleCi build process

## [0.2.0] - 2021-01-21

### Added

- refresh_flow to `/oauth/token` endpoint

## [0.1.0] - 2020-12-18

### Added

- Three endpoints all available on `/api/v1`:
  1. `/oauth/token` to get JWTs,
  2. `/compute` to submit AtomicInput compute request,
  3. `/compute/result/{task_id}` to request a result delivered as an AtomicResult object.
- Auth provided by Auth0.

[unreleased]: https://github.com/mtzgroup/chemcloud-server/compare/0.10.1...HEAD
[0.10.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.10.1
[0.10.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.10.0
[0.9.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.9.1
[0.9.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.9.0
[0.8.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.8.1
[0.8.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.8.0
[0.7.2]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.7.2
[0.7.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.7.1
[0.7.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.7.0
[0.6.2]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.6.2
[0.6.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.6.1
[0.6.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.6.0
[0.5.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.5.1
[0.5.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.5.0
[0.4.2]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.4.2
[0.4.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.4.1
[0.4.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.4.0
[0.3.5]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.5
[0.3.4]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.4
[0.3.3]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.3
[0.3.2]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.2
[0.3.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.1
[0.3.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.3.0
[0.2.1]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.2.1
[0.2.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.2.0
[0.1.0]: https://github.com/mtzgroup/chemcloud-server/releases/tag/0.1.0
